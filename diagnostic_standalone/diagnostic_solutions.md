# 微信机器人诊断工具解决方案

本文档提供各项测试失败时的详细解决方案。

## 测试1 - 网络连通性测试失败解决方案

### 常见问题及解决方法：

**问题1：百度访问失败**
- 解决方案：
  1. 检查本地网络连接是否正常
  2. 尝试在浏览器中访问 https://www.baidu.com
  3. 检查防火墙设置，确保允许程序访问网络
  4. 如果在公司网络，联系网络管理员确认网络策略
  5. 尝试使用手机热点测试网络环境

**问题2：vg.v1api.cc访问失败**
- 解决方案：
  1. 检查DNS解析是否正常，尝试更换DNS服务器（如8.8.8.8）
  2. 尝试直接访问解析出的IP地址
  3. 检查是否有网络代理或VPN影响连接
  4. 确认目标服务器是否正常运行
  5. 如果是临时网络问题，稍后重试

**问题3：DNS解析失败**
- 解决方案：
  1. 更换DNS服务器为公共DNS（8.8.8.8, 114.114.114.114）
  2. 清除DNS缓存：在命令行运行 `ipconfig /flushdns`
  3. 检查网络适配器DNS设置
  4. 重启网络适配器或路由器
  5. 检查是否有DNS劫持或网络限制

**问题4：所有网络测试都失败**
- 解决方案：
  1. 检查网络连接状态，确保已连接到互联网
  2. 临时关闭防火墙和杀毒软件测试
  3. 检查代理设置，确保程序能正常访问网络
  4. 重启网络服务或重新连接网络
  5. 联系网络服务提供商确认网络状态

## 测试2 - 对话测试失败解决方案

### 常见问题及解决方法：

**问题1：DeepSeek API密钥未配置**
- 解决方案：
  1. 打开 `config.py` 文件
  2. 找到 `DEEPSEEK_API_KEY = ''` 这一行
  3. 在引号内填入你的API密钥
  4. 保存文件并重新运行诊断

**问题2：API连接超时或网络错误**
- 解决方案：
  1. 确保网络连通性测试已通过
  2. 确认防火墙没有阻止程序访问API服务器
  3. 如果使用代理，请确保代理配置正确
  4. 尝试更换API基础URL（如从官方API换到第三方代理）

**问题3：API密钥无效**
- 解决方案：
  1. 登录你的API服务商网站
  2. 检查API密钥是否正确
  3. 确认账户是否有足够余额
  4. 重新生成新的API密钥并更新配置

**问题4：模型名称错误**
- 解决方案：
  1. 检查 `config.py` 中的 `MODEL` 配置
  2. 确认模型名称与API服务商提供的名称一致
  3. 常用模型名：`deepseek-chat`、`deepseek-v3-0324`

## 测试3 - 模型测试失败解决方案

### 常见问题及解决方法：

**问题1：配置文件加载失败**
- 解决方案：
  1. 确认 `config.py` 文件存在于项目根目录
  2. 检查文件是否有语法错误
  3. 确保文件编码为UTF-8

**问题2：MAX_TOKEN配置异常**
- 解决方案：
  1. 打开 `config.py` 文件
  2. 将 `MAX_TOKEN` 设置为合理值（建议1000-4000）
  3. 不要设置为0或负数，也不要超过模型限制

**问题3：TEMPERATURE配置异常**
- 解决方案：
  1. 将 `TEMPERATURE` 设置为0.1-2.0之间的值
  2. 推荐值：0.7-1.3
  3. 较低值使输出更确定，较高值使输出更随机

**问题4：缺少必要配置项**
- 解决方案：
  1. 对比完整的config.py模板
  2. 添加缺失的配置项
  3. 确保所有必需配置都有默认值

## 测试4 - 记忆整理测试失败解决方案

### 常见问题及解决方法：

**问题1：记忆功能配置缺失**
- 解决方案：
  1. 在 `config.py` 中添加 `ENABLE_MEMORY = True`
  2. 配置 `MEMORY_TEMP_DIR = 'Memory_Temp'`
  3. 设置 `MAX_MESSAGE_LOG_ENTRIES` 和 `MAX_MEMORY_NUMBER`

**问题2：prompts目录不存在**
- 解决方案：
  1. 在项目根目录创建 `prompts` 文件夹
  2. 确保文件夹名称正确（全小写）
  3. 检查文件夹权限，确保程序可以访问

**问题3：未找到prompt文件**
- 解决方案：
  1. 在 `prompts` 目录中创建 `.md` 格式的prompt文件
  2. 文件名应与 `LISTEN_LIST` 中配置的角色名对应
  3. 确保文件内容不为空，包含角色设定信息

**问题4：目录权限问题**
- 解决方案：
  1. 确保程序有读写项目目录的权限
  2. 在Windows上，尝试以管理员身份运行
  3. 在Linux/Mac上，检查文件夹权限设置

## 测试5 - 基本功能测试失败解决方案

### 常见问题及解决方法：

**问题1：未检测到微信进程**
- 解决方案：
  1. 启动微信PC版客户端
  2. 确保微信已完全加载（不是最小化到托盘）
  3. 使用任务管理器确认微信进程存在
  4. 重启微信后再次测试

**问题2：wxauto模块导入失败**
- 解决方案：
  1. 检查 `Mwxauto` 文件夹是否存在
  2. 确认 `wxauto.py` 文件完整
  3. 检查Python路径配置
  4. 重新下载或修复wxauto模块文件

**问题3：微信版本不兼容**
- 解决方案：
  1. 更新到最新版本的微信PC版
  2. 或降级到兼容的微信版本
  3. 查看wxauto文档确认支持的微信版本
  4. 考虑使用其他微信自动化方案

**问题4：权限不足**
- 解决方案：
  1. 以管理员身份运行程序
  2. 关闭杀毒软件的实时保护
  3. 将程序添加到杀毒软件白名单
  4. 检查Windows UAC设置

## 测试6 - 用户获取测试失败解决方案

### 常见问题及解决方法：

**问题1：LISTEN_LIST配置缺失**
- 解决方案：
  1. 打开 `config.py` 文件
  2. 配置 `LISTEN_LIST = [['微信昵称', '角色名']]`
  3. 确保微信昵称与实际好友昵称完全一致
  4. 保存文件并重新测试

**问题2：LISTEN_LIST为空**
- 解决方案：
  1. 添加至少一个用户到监听列表
  2. 格式：`[['好友昵称', '对应角色文件名']]`
  3. 可以添加多个用户：`[['用户1', '角色1'], ['用户2', '角色2']]`

**问题3：微信接口调用失败**
- 解决方案：
  1. 确保微信处于登录状态
  2. 将微信窗口置于前台
  3. 检查微信是否被其他程序占用
  4. 重启微信并重新测试

**问题4：无法获取当前用户信息**
- 解决方案：
  1. 确保微信完全加载完成
  2. 检查微信界面是否正常显示
  3. 尝试手动点击微信界面激活
  4. 重新登录微信账号

## 测试7 - 微信交互测试失败解决方案

### 常见问题及解决方法：

**问题1：表情包目录不存在**
- 解决方案：
  1. 在项目根目录创建 `emojis` 文件夹
  2. 在emojis下创建情绪分类子文件夹（如happy、sad等）
  3. 确保文件夹名称与配置一致

**问题2：未找到表情包文件**
- 解决方案：
  1. 在各个情绪文件夹中添加图片文件
  2. 支持格式：.png、.jpg、.jpeg、.gif
  3. 确保文件不为空且格式正确
  4. 检查文件权限，确保程序可以读取

**问题3：无法获取联系人信息**
- 解决方案：
  1. 确保微信已完全加载并处于登录状态
  2. 检查 `LISTEN_LIST` 配置是否正确
  3. 尝试在微信中发送一条消息以产生消息记录
  4. 确保微信窗口处于前台并可见

**问题4：聊天窗口打开失败**
- 解决方案：
  1. 确保目标联系人存在于好友列表中
  2. 检查联系人昵称是否与配置完全一致
  3. 尝试手动打开一次聊天窗口确认微信正常
  4. 重启微信并重新测试

**问题5：表情输入功能失败**
- 解决方案：
  1. 确保聊天窗口已正确打开
  2. 检查输入框是否处于可编辑状态
  3. 验证表情文件格式和大小是否合适
  4. 尝试手动在输入框中输入内容确认功能正常

**问题6：微信接口权限问题**
- 解决方案：
  1. 以管理员身份运行诊断工具
  2. 关闭杀毒软件的行为监控功能
  3. 将程序添加到安全软件白名单
  4. 检查Windows UAC设置
  5. 确保微信没有被其他自动化工具占用

**问题7：微信版本兼容性问题**
- 解决方案：
  1. 检查当前微信版本是否与wxauto兼容
  2. 考虑升级或降级微信到兼容版本
  3. 查看wxauto文档确认支持的微信版本范围
  4. 如果版本不兼容，考虑使用其他自动化方案

## 通用解决方案

### 环境问题：
1. **Python版本**：确保使用Python 3.7+
2. **依赖安装**：运行 `pip install -r requirements.txt`
3. **路径问题**：确保在项目根目录运行程序
4. **编码问题**：确保所有文件使用UTF-8编码

### 系统问题：
1. **重启程序**：关闭所有相关进程后重新启动
2. **重启微信**：完全退出微信后重新登录
3. **重启系统**：在某些情况下需要重启计算机
4. **更新软件**：确保使用最新版本的程序和微信

### 配置问题：
1. **备份配置**：修改配置前先备份原文件
2. **逐步配置**：一次只修改一个配置项
3. **验证配置**：使用JSON验证工具检查配置语法
4. **参考示例**：对照完整的配置示例文件

如果以上解决方案都无法解决问题，请：
1. 记录详细的错误信息
2. 检查系统日志
3. 尝试在不同环境下运行
4. 联系技术支持或查看项目文档