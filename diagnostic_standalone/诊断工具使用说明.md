# 微信机器人一键诊断工具使用说明

## 📋 功能介绍

这是一个独立的诊断工具，类似360软件的一键诊断功能，用于全面检测微信机器人的各项功能状态。

### 🔧 诊断项目详解

1. **🌐 网络连通性测试** - 优先检测网络环境（最高优先级）
   - 测试访问百度（https://www.baidu.com）验证基本网络连通性
   - 检测vg.v1api.cc的IP连通性和域名解析
   - 验证DNS解析功能（测试多个知名域名）
   - 综合评估网络状态，确保后续测试的网络基础

2. **💬 对话测试** - 检测AI对话接口连通性
   - 验证DeepSeek API密钥是否有效
   - 测试API连接是否正常
   - 发送测试消息确认AI能正常回复
   - 检查网络连接和API服务状态

3. **🤖 模型测试** - 验证模型配置参数
   - 检查config.py文件是否正确加载
   - 验证MODEL、MAX_TOKEN、TEMPERATURE等关键配置
   - 确认参数值在合理范围内（如MAX_TOKEN不超过8000）
   - 检测配置文件语法错误

4. **🧠 记忆整理测试** - 验证记忆功能和文件结构
   - 检查ENABLE_MEMORY配置
   - 验证Memory_Temp目录是否存在
   - 检查prompts目录和角色文件
   - 测试记忆文件读写权限

5. **⚙️ 基本功能测试** - 检测微信进程和基础模块
   - 扫描微信进程是否运行
   - 测试wxauto模块导入
   - 检查微信客户端版本兼容性
   - 验证程序运行权限

6. **👥 用户获取测试** - 验证用户配置和微信接口
   - 检查LISTEN_LIST配置
   - 测试微信用户信息获取
   - 验证监听用户配置格式
   - 检查角色文件对应关系

7. **💫 微信交互测试** - 完整的微信交互功能验证
   - 检查emojis表情包目录和文件
   - 获取第一个联系人信息
   - 模拟打开聊天窗口操作
   - 测试在输入框中输入表情的完整流程
   - 验证微信自动化接口的完整交互链路

## 🚀 快速开始

### 方法1：使用批处理文件（推荐）

1. **确保主程序已关闭**
   ```
   关闭正在运行的bot.py或其他主程序
   ```

2. **双击运行**
   ```
   双击 run_diagnostic.bat 文件
   ```

3. **打开浏览器**
   ```
   在浏览器中访问: http://localhost:5001
   ```

### 方法2：手动启动

1. **安装依赖**
   ```bash
   pip install flask flask-cors psutil requests openai
   ```

2. **启动诊断工具**
   ```bash
   python diagnostic_tool.py
   ```

3. **访问界面**
   ```
   浏览器访问: http://localhost:5001
   ```

## 📱 使用界面

### 主界面功能

- **开始诊断按钮**: 点击开始执行所有测试
- **进度条**: 显示整体诊断进度
- **测试列表**: 显示7项测试的实时状态
- **日志面板**: 显示详细的诊断日志

### 状态说明

- **⏳ 等待中**: 灰色，测试尚未开始
- **🔄 进行中**: 蓝色，测试正在执行，显示转转转动画
- **✅ 成功**: 绿色，测试通过
- **❌ 失败**: 红色，测试失败，点击可查看解决方案

## 🛠️ 故障排除

### 常见问题

**Q1: 诊断工具启动失败**
- 确保Python 3.7+已安装
- 检查是否有其他程序占用5001端口
- 以管理员身份运行

**Q2: 浏览器无法访问**
- 确认诊断工具已成功启动
- 尝试访问 http://127.0.0.1:5001
- 检查防火墙设置

**Q3: 测试结果不准确**
- 确保主程序（bot.py）已完全关闭
- 重启微信后再次测试
- 检查配置文件是否正确

### 解决方案查看

当测试失败时：
1. 点击测试项右侧的❌图标
2. 查看弹出的详细解决方案
3. 按照步骤操作后重新诊断

## 📂 文件结构

```
项目根目录/
├── diagnostic_tool.py          # 诊断工具主程序
├── run_diagnostic.bat          # 启动脚本
├── diagnostic_solutions.md     # 解决方案文档
├── 诊断工具使用说明.md         # 本文档
└── templates/
    └── diagnostic.html         # 诊断界面
```

## ⚠️ 重要注意事项

### 使用前提

1. **关闭主程序**: 必须先关闭bot.py等主程序
2. **微信状态**: 确保微信PC版已启动并登录
3. **网络连接**: 确保网络连接正常
4. **权限要求**: 建议以管理员身份运行

### 安全提示

- 诊断工具是只读检测，不会修改任何配置
- 不会发送实际消息给用户
- 所有测试都在本地进行，保护隐私安全

## 🔄 诊断流程

### 自动诊断流程

1. **启动检查**: 验证环境和依赖
2. **配置检测**: 读取和验证配置文件
3. **逐项测试**: 按顺序执行7项测试
4. **结果汇总**: 显示整体诊断结果
5. **问题定位**: 为失败项目提供解决方案

### 测试顺序

测试按照优先级和依赖关系重新排序：
1. **网络连通性测试**（最高优先级，确保网络基础）
2. **对话测试**（基础API连通性）
3. **模型测试**（配置参数验证）
4. **记忆整理测试**（文件系统）
5. **基本功能测试**（微信环境）
6. **用户获取测试**（用户配置）
7. **微信交互测试**（完整功能链，包含实际交互操作）

**重要说明**：
- 网络测试优先进行，确保所有依赖网络的功能有良好的基础
- 微信交互测试增强为完整的交互流程验证
- 测试顺序经过优化，提高问题定位的准确性

## 📈 性能说明

- **执行时间**: 完整诊断约需30-60秒
- **资源占用**: 轻量级，内存占用<50MB
- **网络使用**: 仅在测试API连通性时使用网络
- **并发安全**: 同时只能运行一个诊断实例

## 🆘 技术支持

如果遇到问题：

1. **查看日志**: 诊断界面右侧有详细日志
2. **查阅文档**: 参考diagnostic_solutions.md
3. **重试诊断**: 解决问题后重新运行诊断
4. **环境检查**: 确认Python、微信、网络环境正常

## 📝 更新日志

### v1.1.0 (最新)
- **重要更新**：调整测试顺序，网络连通性测试提升为最高优先级
- **增强功能**：网络测试新增vg.v1api.cc IP连通性检测
- **全新功能**：微信交互测试升级，支持完整的聊天窗口打开和表情输入流程
- **界面优化**：测试项目名称增加图标，更直观易懂
- **文档更新**：解决方案文档全面更新，对应新的测试内容

### v1.0.0
- 初始版本发布
- 支持7项核心功能测试
- 提供Web界面和详细日志
- 包含完整的解决方案文档

---

**提示**: 建议在每次使用机器人前运行一次诊断，确保所有功能正常。